<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calling Manager</title>
    <link rel="stylesheet" href="styles.css">
    
</head>

<body>
    <div class="overlay" id="popup-overlay" onclick="closePopup()"></div>
    <div class="overlay" id="add-member-overlay" onclick="closeAddMemberModal()"></div>
    <div class="overlay" id="add-calling-overlay" onclick="closeAddCallingModal()"></div>
    
    
    <div id="auth-container">
    <form id="auth-form">
        <h2>Kimberly 1st Calling Manager</h2>
        <label for="pin">Enter PIN:</label>
        <input type="password" id="pin" name="pin" required autocomplete="new-pin">
        <button type="submit">Submit</button>
    </form>
    <div id="auth-message"></div> <!-- To display any messages (success/error) -->
</div>

<div id="app-content" style="display: none;">
    <!-- Main Tabs -->
    <div class="tabs-container">
        <!-- Ward Title -->
        <div class="ward-title">Kimberly 1st</div>
        <!-- Desktop Tabs -->
        <div class="tabs desktop-tabs">
            <button class="tablinks" id="tab0-title" onclick="openTab(event, 'Tab0')">Dashboard</button>
            <button class="tablinks" id="tab1-title" onclick="openTab(event, 'Tab1')">Callings Overview</button>
            <button class="tablinks" id="tab2-title" onclick="openTab(event, 'Tab2')">Assign/Release Callings</button>
            <button class="tablinks" id="tab3-title" onclick="openTab(event, 'Tab3')">Member Information</button>
            <button class="tablinks" id="tab4-title" onclick="openTab(event, 'Tab4')">Calling Information</button>
            
        </div>
        
        <!-- Mobile Menu -->
        <div class="mobile-nav">
            <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
                <span class="hamburger-icon">☰</span>
                <span class="current-tab-text">Callings Overview</span>
            </button>
            <div class="mobile-dropdown" id="mobile-dropdown">
                <button class="mobile-tablink" onclick="openTab(event, 'Tab0')">Dashboard</button>
                <button class="mobile-tablink" onclick="openTab(event, 'Tab1')">Callings Overview</button>
                <button class="mobile-tablink" onclick="openTab(event, 'Tab2')">Assign/Release Callings</button>
                <button class="mobile-tablink" onclick="openTab(event, 'Tab3')">Member Information</button>
                <button class="mobile-tablink" onclick="openTab(event, 'Tab4')">Calling Information</button>
                
            </div>
        </div>
    </div>

    <!-- Context-sensitive sub-bar -->
    <div class="sub-bar">
        <div id="subbar-Tab0" class="subcontent">
            <!-- Options for Dashboard -->
        </div>
        
        <div id="subbar-Tab1" class="subcontent">
            <!-- Options for Tab 1 -->

            <button class="toggle-btn ym-btn" data-org="AaronicPriesthoodQuorums">AP</button>
            <button class="toggle-btn additional-btn" data-org="AdditionalCallings">Additional</button>
            <button class="toggle-btn bishopric-btn" data-org="Bishopric">Bishopric</button>
            <button class="toggle-btn elders-btn" data-org="EldersQuorum">EQ</button>
            <button class="toggle-btn mission-btn" data-org="FullTimeMissionaries">Mission</button>
            <button class="toggle-btn music-btn" data-org="Music">Music</button>
            <button class="toggle-btn primary-btn" data-org="Primary">Primary</button>
            <button class="toggle-btn rs-btn" data-org="ReliefSociety">RS</button>
            <button class="toggle-btn stake-btn" data-org="Stake">Stake</button>
            <button class="toggle-btn ss-btn" data-org="SundaySchool">SS</button> 
            <button class="toggle-btn wos-btn" data-org="TempleandFamilyHistory">WoS</button>
            <button class="toggle-btn yw-btn" data-org="YoungWomen">YW</button>
             
             
            
            <button class="toggle-btn clear-all-btn" onclick="clearAll()">Clear All</button>
            <button class="toggle-btn show-all-btn" onclick="showAll()">Show All</button>
        </div>
        
        <div id="subbar-Tab2" class="subcontent">
            <!-- Options for Tab 2 -->

        </div>
        
        <div id="subbar-Tab3" class="subcontent">
            <!-- Options for Tab 3 -->
        </div>
        
        <div id="subbar-Tab4" class="subcontent">
            <!-- Options for Tab 4 -->
        </div>
    </div>

    <!-- Tab Content -->
    <div id="Tab0" class="tabcontent">
        <div class="large-box" id="dashboard-container">
            <!-- Dashboard content will be dynamically generated here -->
        </div>
    </div>
    
    <div id="Tab1" class="tabcontent">
        <!-- Legend Key -->
        <div class="legend-key">
            <span class="legend-item">
                <span class="delta-symbol">▲</span> Considering change
            </span>
            <span class="legend-item">
                <span class="checkmark-symbol">✓</span> Calling approved
            </span>
        </div>
        
        <div class="large-box" id="large-box">


   
        </div>
    </div>
    
    <div id="Tab2" class="tabcontent">
        <div class="information-box">
        
            <form id="calling-form">
                <div class="two-column-layout">
                    <!-- Left Column: Form Controls -->
                    <div class="left-column">
                        <!-- Member Search & Selection Section -->
                        <div class="section-header">
                            <h3>Member Selection</h3>
                        </div>
                        <div class="search-section">
                            <div class="search-column">
                                <div class="search-field">
                                    <label for="member-search-tab2">Search Members:</label>
                                    <input type="text" id="member-search-tab2" placeholder="Type name to search..." />
                                </div>
                            </div>
                        </div>
                        <div class="selection-section">
                            <label for="member">Select Member:</label>
                            <select name="member_id" id="member-select" required>
                                <option value="">Select a Member</option>
                            </select>
                        </div>

                        <!-- Calling Search & Selection Section -->
                        <div class="section-header">
                            <h3>Calling Selection</h3>
                        </div>
                        <div class="search-section">
                            <div class="search-column">
                                <div class="search-field">
                                    <label for="calling-search-tab2">Search Callings:</label>
                                    <input type="text" id="calling-search-tab2" placeholder="Type calling name to search..." />
                                </div>
                            </div>
                        </div>
                        <div class="selection-section">
                            <label for="calling">Select Calling:</label>
                            <select name="calling_id" id="calling-select" required>
                                <option value="">Select a Calling</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Right Column: Tables and Details -->
                    <div class="right-column">
                        <div class="section-header">
                            <h3>Current Information</h3>
                        </div>
                        <div class="details-section">
                            <div id="member-callings-container"></div> <!-- Table for current callings -->
                            <div id="calling-members-container"></div> <!-- Table for members with this calling -->
                        </div>

                        <!-- Date & Action Section -->
                        <div class="section-header">
                            <h3>Date & Actions</h3>
                        </div>
                        <div class="details-section">
                            <div id="changes-preview" style="background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; padding: 15px; margin-bottom: 20px; display: none;">
                                <h5 style="margin: 0 0 10px 0; color: #495057;">Changes to be made:</h5>
                                <div id="changes-text" style="color: #212529; font-weight: 500;"></div>
                            </div>
                            
                            <div id="remove-other-candidates-section" style="background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; padding: 15px; margin-bottom: 20px; display: none;">
                                <h5 style="margin: 0 0 10px 0; color: #495057;">Other candidates for this calling:</h5>
                                <label style="color: #212529; font-weight: 500;">
                                    <input type="checkbox" id="remove-other-candidates-checkbox">
                                    Remove all other members under consideration for this calling:
                                </label>
                                <div id="other-candidates-list" style="margin-left: 20px; margin-top: 10px; font-style: italic; color: #666;">
                                    <!-- Other candidates will be listed here -->
                                </div>
                            </div>
                            
                            <label for="date_set_apart">Date of Change:</label>
                            <input type="date" name="date_set_apart" id="date-set-apart" required>
                            
                            <div class="action-buttons">
                                <button type="button" id="make-changes-btn" class="action-btn save-btn" disabled>Finalize These Changes</button>
                            </div>
                            <div id="form-response"></div>
                        </div>
                    </div>
                </div>
            </form>

        </div>    
    </div>

    <div id="Tab3" class="tabcontent">
        <div class="information-box">
            <div id="member-information-container">
                <!-- Member form content will be dynamically generated here -->
            </div>
        </div>
    </div>

    <div id="Tab4" class="tabcontent">
        <div class="information-box">
            <div id="calling-information-container">
                <!-- Calling form content will be dynamically generated here -->
            </div>
        </div>
    </div>
</div>

<!-- Calling candidates Popup Modal -->
<div id="popup-modal" class="modal">
    <button class="close-btn" onclick="closePopup()">✕ Save and Close</button>
    <div class="modal-content">
        <h2 id="popup-title"></h2>
        
        <div class="section-header">
            <h3>Current Calling Holder</h3>
        </div>
        
        <div id="current-calling-holder">
            <p>Loading current calling holder...</p>
        </div>
        
        <div class="section-header">
            <h3>Choose Candidates</h3>
        </div>
        
        <label for="candidate-search">Search by Name:</label>
        <input type="text" id="candidate-search" placeholder="Type name to search..." oninput="applyFilters()" />
        
        <label for="callingDropdown">Select Candidate:</label>
        <select id="callingDropdown">
            <option value="">Select a Candidate</option>
        </select>
        
        <div class="section-header">
            <h3>Candidates Considered</h3>
        </div>
        
        <div id="selectionList"></div>
        
        <div class="section-header">
            <h3>Notes</h3>
        </div>
        
        <label for="candidate-notes">Additional Notes:</label>
        <textarea id="candidate-notes" class="custom-textarea"></textarea>
    </div>
</div>

<!-- Add New Member Modal -->
<div id="add-member-modal" class="modal">
    <div class="modal-content">
        <button class="close-btn" onclick="closeAddMemberModal()">✕ Close</button>
        <h2>Add New Member</h2>

        <label for="first-name-input">First Name:</label>
        <input type="text" id="first-name-input" />

        <label for="last-name-input">Last Name:</label>
        <input type="text" id="last-name-input" />

        <label for="gender-input">Gender:</label>
        <select id="gender-input">
            <option value="">Select Gender</option>
            <option value="M">Male</option>
            <option value="F">Female</option>
        </select>

        <label for="birthdate-input">Birthdate:</label>
        <input type="date" id="birthdate-input" />

        <label for="status-input">Status:</label>
        <select id="status-input">
            <option value="active">Active</option>
            <option value="inactive">Inactive</option>
            <option value="moved">Moved Away</option>
            <option value="no_calling">No Current Calling</option>
            <option value="deceased">Deceased</option>
            <option value="unknown">Status Unknown</option>
        </select>

        <label for="status-notes-input">Status Notes (optional):</label>
        <textarea id="status-notes-input" placeholder="Additional notes about this member's status..." rows="3"></textarea>

        <button id="save-member-btn" class="toggle-btn save-btn" onclick="saveNewMember()">Save</button>
    </div>
</div>

<!-- Add New Calling Modal -->
<div id="add-calling-modal" class="modal">
    <div class="modal-content">
        <button class="close-btn" onclick="closeAddCallingModal()">✕ Close</button>
        <h2>Add New Calling</h2>

        <label for="calling-name-input">Calling Name:</label>
        <input type="text" id="calling-name-input" />

        <label for="calling-organization-input">Organization:</label>
        <select id="calling-organization-input">
                <option value="Aaronic Priesthood Quorums">Aaronic Priesthood Quorums</option>
                <option value="Additional Callings">Additional Callings</option>
                <option value="Bishopric">Bishopric</option>
                <option value="Elders Quorum">Elders Quorum</option>
                <option value="Facilities">Facilities</option>
                <option value="Full-Time Missionaries">Full-Time Missionaries</option>
                <option value="History">History</option>
                <option value="Music">Music</option>
                <option value="Primary">Primary</option>
                <option value="Relief Society">Relief Society</option>
                <option value="Stake">Stake</option>
                <option value="Sunday School">Sunday School</option>
                <option value="Technology">Technology</option>
                <option value="Temple and Family History">Temple and Family History</option>
                <option value="Ward Missionaries">Ward Missionaries</option>
                <option value="Welfare and Self-Reliance">Welfare and Self-Reliance</option>
                <option value="Young Women">Young Women</option>
        </select>

        <label for="calling-grouping-input">Grouping:</label>
        <select id="calling-grouping-input">
            <option value="AP Advisors">AP Advisors</option>
            <option value="AP Class Presidency">AP Class Presidency</option>
            <option value="Additional Callings">Additional Callings</option>
            <option value="Bishopric">Bishopric</option>
            <option value="Elders Quorum">Elders Quorum</option>
            <option value="Full-Time Missionaries">Full-Time Missionaries</option>
            <option value="Music">Music</option>
            <option value="Primary Teachers">Primary Teachers</option>
            <option value="Primary Other">Primary Other</option>
            <option value="Primary Presidency">Primary Presidency</option>
            <option value="RS Other">RS Other</option>
            <option value="RS Presidency">RS Presidency</option>
            <option value="Stake">Stake</option>
            <option value="SS Teachers">SS Teachers</option>
            <option value="SS Other">SS Other</option>
            <option value="SS Presidency">SS Presidency</option>
            <option value="Work of Salvation">Work of Salvation</option>
            <option value="YW Class Presidency">YW Class Presidency</option>
            <option value="YW Presidency">YW Presidency</option>
        </select>


        <label for="calling-priority-input">Priority:</label>
        <input type="text" value="0" id="calling-priority-input" />

        <button id="save-calling-btn" class="toggle-btn save-btn" onclick="saveNewCalling()">Save</button>
    </div>
</div>

<!-- Add Calling History Modal -->
<div id="add-calling-history-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <button class="close-btn" onclick="closeAddCallingHistoryModal()">✕ Close</button>
        <h2>Add Calling History</h2>
        
        <p>Add historical callings for <strong id="history-member-name">Member Name</strong></p>
        
        <div class="section-header">
            <h3>Select Calling</h3>
        </div>
        
        <label for="history-calling-select">Choose Calling:</label>
        <select id="history-calling-select">
            <option value="">Select a Calling</option>
        </select>
        
        <label for="history-period">Approximate Period (optional):</label>
        <input type="text" id="history-period" placeholder="e.g., 2010-2015, Early 2000s, Around 2018" />
        
        <label for="history-notes">Notes (optional):</label>
        <textarea id="history-notes" rows="3" placeholder="Any additional information about this calling..."></textarea>
        
        <button type="button" onclick="addCallingToHistoryTable()" class="action-btn save-btn">Add to List</button>
        
        <div class="section-header">
            <h3>Calling History to Add</h3>
        </div>
        
        <div id="history-table-container">
            <table id="history-table" style="display: none;">
                <thead>
                    <tr>
                        <th>Calling</th>
                        <th>Period</th>
                        <th>Notes</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="history-table-body">
                </tbody>
            </table>
            <p id="no-history-message">No calling history added yet.</p>
        </div>
        
        <div style="margin-top: 20px; text-align: center;">
            <button type="button" onclick="saveCallingHistory()" class="action-btn save-btn" id="save-history-btn" style="display: none;">Save All History</button>
        </div>
        
        <div id="history-form-message" style="margin-top: 10px; text-align: center;"></div>
    </div>
</div>

<!-- Update Members Modal -->
<div id="update-members-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <button class="close-btn" onclick="closeUpdateMembersModal()">✕ Close</button>
        <h2>Update Members from PDF</h2>
        
        <div class="section-header">
            <h3>Upload Member List</h3>
            <div id="last-update-info" class="last-update-info">
                <!-- Last update info will be loaded here -->
            </div>
        </div>
        
        <div class="upload-section">
            <p>Download the Member List PDF at Leader and Clerk Resources -> Membership -> Member Directory -> Print.  Then upload here.</p>
            
            <div class="file-upload-container">
                <input type="file" id="member-pdf-upload" accept=".pdf" onchange="handleMemberPDFUpload(this)" />
                <label for="member-pdf-upload" class="upload-label">
                    Choose PDF File
                </label>
                <div id="upload-status" class="upload-status"></div>
            </div>
            
            <div id="upload-progress" class="progress-container" style="display: none;">
                <div class="progress-bar">
                    <div id="progress-fill" class="progress-fill"></div>
                </div>
                <div id="progress-text" class="progress-text">Processing...</div>
            </div>
        </div>
        
        <div id="reconciliation-results" class="reconciliation-section" style="display: none;">
            <div class="section-header">
                <h3>Reconciliation Results</h3>
            </div>
            
            <div class="results-summary">
                <div class="summary-stats">
                    <div class="stat-item">
                        <span class="stat-label">New Members:</span>
                        <span class="stat-value" id="new-members-count">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Updates:</span>
                        <span class="stat-value" id="updates-count">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">No Changes:</span>
                        <span class="stat-value" id="no-changes-count">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Removed:</span>
                        <span class="stat-value" id="removed-count">0</span>
                    </div>
                </div>
            </div>
            
            <div id="changes-review" class="changes-review">
                <!-- Detailed changes will be displayed here -->
            </div>
            
            <div class="action-buttons">
                <button id="apply-changes-btn" class="action-btn save-btn" onclick="applyMemberChanges()">Apply All Changes</button>
                <button id="review-changes-btn" class="action-btn edit-btn" onclick="reviewMemberChanges()">Review Changes</button>
                <button class="action-btn cancel-btn" onclick="closeUpdateMembersModal()">Cancel</button>
            </div>
        </div>
    </div>
</div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="client-validation.js"></script>
    <script src="script.js"></script>
</body>

</html>
